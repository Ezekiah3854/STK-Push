{% extends 'index.html'%}
{% block title%}Payment confirmation{% endblock%}
{% block container%}
<div class="hero min-h-screen bg-base-200">
    <div class="hero-content flex flex-col items-center text-center">
        <h1 class="text-5xl font-bold mb-4">Payment Confirmation</h1>
        <div class="card w-full max-w-xl p-5 shadow-2xl bg-blue-100">
            <div class="flex-col justify-center items-center">
                {% if status == "pending" %}
                <div id="status-icon" class="text-black font-bold text-3xl">
                    <div class="loading loading-bars loading-2xl w-10"></div>
                    <p class="mt-6">Processing...</p>
                </div>
                <div class="card-body space-y-4 text-black">
                    <p id="status-message" class="text-lg">{{ message }}</p>
                </div>
                {% elif status == "success" %}
                <span id="status-icon" class="text-green-600 text-3xl font-bold">&#10003;</span>
                <div class="card-body space-y-4 text-black">
                    <p id="status-message" class="text-lg">{{ message }}</p>
                </div>
                <div>
                <button id="next-transaction" class="btn btn-soft btn-success"></button>

                {% elif status == "failed" %}
                <span id="status-icon" class="text-red-600 text-3xl font-bold">&#10007;</span>
                <div class="card-body space-y-4 text-black">
                    <p id="status-message" class="text-lg">{{ message }}</p>
                </div>
                <div>
                <div id="retry-transaction-link"></div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<script>
    let currentStatus = "{{ status }}";
    function updateStatus() {
        fetch("/payment_status")
            .then(res => res.json())
            .then(data => {
                if (data.status !== currentStatus) {
                    currentStatus = data.status;
                    const iconDiv = document.getElementById("status-icon");
                    const msgP = document.getElementById("status-message");
                    const next_transaction = document.getElementById("next-transaction");
                    const retryLink = document.getElementById("retry-transaction-link");
                    if (currentStatus === "pending") {
                        iconDiv.innerHTML = '<span class="loading loading-bars loading-2xl"></span>';
                        msgP.textContent = data.message;
                    } else if (currentStatus === "success") {
                        iconDiv.innerHTML = '<span class="text-green-600 text-3xl font-bold">&#10003;</span>';
                        msgP.textContent = data.message;
                        next_transaction.textContent = "Start another transaction";
                    } else if (currentStatus === "failed") {
                        iconDiv.innerHTML = '<span class="text-red-600 text-3xl font-bold">&#10007;</span>';
                        msgP.textContent = data.message;
                        retryLink.innerHTML = '<a href="/" style="color: blue; text-decoration: underline;">Retry the transaction</a>'
                    }
                }
                if (currentStatus === "pending") {
                    setTimeout(updateStatus, 2000);
                }
            });
    }
    if (currentStatus === "pending") {
        setTimeout(updateStatus, 2000);
    }
</script>

{% endblock %}